<div class="crear-masivo-container">
  <h1 class="page-title">Crear productos masivo</h1>

  <div class="info-section">
    <div class="alert alert-info">
      <mat-icon class="alert-icon">info</mat-icon>
      <div class="info-content">
        <strong>Formato del archivo:</strong>
        <p>El archivo debe contener las siguientes columnas en orden:</p>
        <code>name, details, store, batch, image_url, due_date, stock, price_per_unite, provider_id</code>
        <p class="mt-small">Formato de fecha: YYYY-MM-DD (ejemplo: 2025-12-31)</p>
      </div>
      <button class="btn-download" (click)="descargarPlantilla()">
        <mat-icon>download</mat-icon>
        Descargar plantilla
      </button>
    </div>
  </div>

  <div class="upload-section">
    <div class="upload-box"
         [class.has-file]="archivoSeleccionado"
         (click)="triggerFileInput()"
         (dragover)="onDragOver($event)"
         (dragleave)="onDragLeave($event)"
         (drop)="onDrop($event)">
      <mat-icon class="upload-icon">cloud_upload</mat-icon>
      <p class="upload-text" *ngIf="!archivoSeleccionado">
        Arrastra un archivo aqu√≠ o haz clic para seleccionar
      </p>
      <div *ngIf="archivoSeleccionado" class="file-info">
        <mat-icon>description</mat-icon>
        <span>{{ nombreArchivo }}</span>
        <button class="btn-remove" (click)="removeFile($event)">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <input
        title="Subir Archivo"
        type="file"
        #fileInput
        class="file-input"
        accept=".csv,.xlsx,.xls"
        (change)="onFileSelected($event)">
    </div>

    <button
      class="btn-primary"
      [disabled]="!archivoSeleccionado || isProcessing"
      (click)="crearProductos()">
      <mat-icon *ngIf="isProcessing" class="spinner-icon">refresh</mat-icon>
      {{ isProcessing ? 'PROCESANDO...' : 'CREAR PRODUCTOS' }}
    </button>
  </div>

  <div class="loading-container" *ngIf="isProcessing">
    <div class="spinner"></div>
    <p>Procesando archivo y creando productos...</p>
  </div>

  <div class="reporte-section" *ngIf="mostrarReporte && !isProcessing">
    <div class="reporte-header">
      <mat-icon [class.success]="reporte.cantidadErrores === 0" [class.warning]="reporte.cantidadErrores > 0">
        {{ reporte.cantidadErrores === 0 ? 'check_circle' : 'warning' }}
      </mat-icon>
      <span class="reporte-label">
        {{ reporte.cantidadErrores === 0 ? 'Carga completada exitosamente' : 'Carga completada con errores' }}
      </span>
    </div>

    <div class="reporte-content">
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-label">Total de registros</span>
          <span class="stat-value">{{ reporte.totalRegistros }}</span>
        </div>
        <div class="stat-card success">
          <span class="stat-label">Registros exitosos</span>
          <span class="stat-value">{{ reporte.registrosExitosos }}</span>
        </div>
        <div class="stat-card error" *ngIf="reporte.cantidadErrores > 0">
          <span class="stat-label">Errores</span>
          <span class="stat-value">{{ reporte.cantidadErrores }}</span>
        </div>
      </div>

      <div class="errores-section" *ngIf="reporte.errores.length > 0">
        <h3 class="errores-title">Detalle de errores:</h3>
        <ul class="errores-list">
          <li *ngFor="let error of reporte.errores">
            <mat-icon>error_outline</mat-icon>
            <span>{{ error }}</span>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div *ngIf="toastMessage" class="toast" [ngClass]="toastType">
    {{ toastMessage }}
  </div>
</div>
